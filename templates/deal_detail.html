{% extends "base.html" %}
{% load static %}

{% block title %}{{ deal.title }} ‚Äî –ê–∫—Ü–∏—è{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/deal.css' %}">

<article class="deal-card">

  <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–∫—Ü–∏–∏ -->
  <div class="deal-image">
    <img id="deal-image" src="{{ deal.image_url|default:'/static/images/placeholder.jpg' }}" alt="{{ deal.title }}">
    <span class="discount-badge" id="discount-badge">‚àí{{ deal.discount_pct|floatformat:0 }}%</span>
  </div>

  <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
  <div class="deal-info">
    <h2 class="deal-title" id="deal-title">{{ deal.title }}</h2>

    <div class="price-block">
      <span class="old-price" id="deal-old">{{ deal.price_original }} ‚ÇΩ</span>
      <span class="new-price" id="deal-new">{{ deal.price_discount }} ‚ÇΩ</span>
    </div>

    <p class="deal-expire" id="deal-expire">
      <i class="fa fa-calendar"></i>
      –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ {{ deal.expires_at|date:"d.m.Y" }}
    </p>

    <div class="deal-actions">
      {% if user.is_authenticated %}
        {% if is_fav %}
          <a class="btn btn-remove" href="{% url 'discounts:toggle_favorite' deal.id %}">
            <i class="fa fa-heart"></i> –£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
          </a>
        {% else %}
          <a class="btn btn-add" href="{% url 'discounts:toggle_favorite' deal.id %}">
            <i class="fa fa-heart-o"></i> –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
          </a>
        {% endif %}
      {% else %}
        <a class="btn btn-login" href="{% url 'login' %}">
          <i class="fa fa-user"></i> –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
        </a>
      {% endif %}

      {% if user.is_staff %}
        <button class="btn-admin edit" id="edit-deal-btn">
          <i class="fa fa-pencil"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </button>
      {% endif %}
    </div>

    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
    <div class="deal-description" id="description-text">
      {% if deal.description %}
        {{ deal.description }}
      {% else %}
        <em>–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ.</em>
      {% endif %}
    </div>
  </div>
</article>

<!-- ===== –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ ===== -->
<div id="edit-modal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</h3>

    <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
    <input type="text" id="title-input" value="{{ deal.title }}">

    <label>–¶–µ–Ω–∞ –±–µ–∑ —Å–∫–∏–¥–∫–∏:</label>
    <input type="number" id="price-original-input" value="{{ deal.price_original }}">

    <label>–¶–µ–Ω–∞ —Å–æ —Å–∫–∏–¥–∫–æ–π:</label>
    <input type="number" id="price-discount-input" value="{{ deal.price_discount }}">

    <label>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
    <input type="date" id="expires-at-input" value="{{ deal.expires_at|date:'Y-m-d' }}">

    <label>–ö–∞—Ä—Ç–∏–Ω–∫–∞ (URL):</label>
    <input type="text" id="image-url-input" value="{{ deal.image_url }}">

    <label>–û–ø–∏—Å–∞–Ω–∏–µ:</label>
    <textarea id="desc-input">{{ deal.description }}</textarea>

    <button id="save-deal-btn" class="btn-admin edit">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
  </div>
</div>

<script src="{% static 'js/edit_deal.js' %}"></script>
{% endblock %}