{% extends "base.html" %}
{% load static %}

{% block title %}{{ deal.title }} — Акция{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/deal.css' %}">

<article class="deal-card">

  <!-- Изображение акции -->
  <div class="deal-image">
    <img src="{{ deal.image_url|default:'/static/images/placeholder.jpg' }}" alt="{{ deal.title }}">
    <span class="discount-badge">−{{ deal.discount_pct|floatformat:0 }}%</span>
  </div>

  <!-- Информация о товаре -->
  <div class="deal-info">
    <h2 class="deal-title">{{ deal.title }}</h2>

    <!-- ✅ Порядок цен: сначала старая, потом новая -->
    <div class="price-block">
      <span class="old-price">{{ deal.price_original }} ₽</span>
      <span class="new-price">{{ deal.price_discount }} ₽</span>
    </div>

    <p class="deal-expire">
      <i class="fa fa-calendar"></i>
      Действует до {{ deal.expires_at|date:"d.m.Y" }}
    </p>

    <!-- Кнопки действий -->
    <div class="deal-actions">
      {% if user.is_authenticated %}
        {% if is_fav %}
          <a class="btn btn-remove" href="{% url 'discounts:toggle_favorite' deal.id %}">
            <i class="fa fa-heart"></i> Убрать из избранного
          </a>
        {% else %}
          <a class="btn btn-add" href="{% url 'discounts:toggle_favorite' deal.id %}">
            <i class="fa fa-heart-o"></i> В избранное
          </a>
        {% endif %}
        <a class="btn btn-secondary" href="{% url 'discounts:my_favorites' %}">
          <i class="fa fa-star"></i> Мои избранные
        </a>
      {% else %}
        <a class="btn btn-login" href="{% url 'login' %}">
          <i class="fa fa-user"></i> Войдите, чтобы добавить в избранное
        </a>
      {% endif %}
    </div>

    {% if deal.description %}
      <hr>
      <p class="deal-description">{{ deal.description }}</p>
    {% endif %}

    {% if user.is_staff %}
      <hr>
      <div class="admin-actions">
        <a class="btn-admin edit" href="{% url 'discounts:deal_edit' deal.id %}">
          <i class="fa fa-pencil"></i> Редактировать
        </a>
        <a class="btn-admin delete" href="{% url 'discounts:deal_delete' deal.id %}">
          <i class="fa fa-trash"></i> Удалить
        </a>
      </div>
    {% endif %}
  </div>

</article>
{% endblock %}