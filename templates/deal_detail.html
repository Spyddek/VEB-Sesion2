{% extends "base.html" %}
{% load static %}

{% block title %}{{ deal.title }} — Акция{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/deal.css' %}">

<article class="deal-card">

  <div class="deal-image">
    <img id="deal-image" src="{{ deal.image_url|default:'/static/images/placeholder.jpg' }}" alt="{{ deal.title }}">
    <span class="discount-badge" id="discount-badge">{{ deal.discount_pct|floatformat:0 }}%</span>
  </div>

  <div class="deal-info">
    <h2 class="deal-title" id="deal-title">{{ deal.title }}</h2>

    <div class="price-block">
      <span class="old-price" id="deal-old">{{ deal.price_original }} ₽</span>
      <span class="new-price" id="deal-new">{{ deal.price_discount }} ₽</span>
    </div>

    {% if deal.expires_at %}
      {% if deal.expires_at < now %}
        <p class="deal-expire expired"><i class="fa fa-clock-o"></i> Акция завершена</p>
      {% else %}
        <p class="deal-expire"><i class="fa fa-calendar"></i> Действует до {{ deal.expires_at|date:"d.m.Y" }}</p>
      {% endif %}
    {% endif %}

    <div class="deal-actions">

      <div class="user-actions">
        {% if user.is_authenticated %}
          {% if is_fav %}
            <a class="btn btn-remove" href="{% url 'discounts:toggle_favorite' deal.id %}">
              <i class="fa fa-heart"></i> Убрать из избранного
            </a>
          {% else %}
            <a class="btn btn-add" href="{% url 'discounts:toggle_favorite' deal.id %}">
              <i class="fa fa-heart-o"></i> В избранное
            </a>
          {% endif %}
        {% else %}
          <a class="btn btn-login" href="{% url 'login' %}">
            <i class="fa fa-user"></i> Войдите, чтобы добавить в избранное
          </a>
        {% endif %}
      </div>

      {% if user.is_staff %}
      <div class="admin-actions">
        <a href="{% url 'discounts:deal_edit' deal.pk %}" class="btn-admin edit">
          Редактировать
        </a>
        <a href="{% url 'discounts:deal_delete' deal.pk %}" class="btn-admin delete">
          Удалить
        </a>
      </div>
      {% endif %}
    </div>

    <div class="deal-description" id="description-text">
      <h3>Описание</h3>
      <p>
        {% if deal.description %}
          {{ deal.description|linebreaks }}
        {% else %}
          <em>Описание пока не добавлено.</em>
        {% endif %}
      </p>
    </div>
  </div>
</article>

<script src="{% static 'js/edit_deal.js' %}"></script>
{% endblock %}