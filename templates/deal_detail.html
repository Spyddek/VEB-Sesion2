{% extends "base.html" %}
{% load static %}

{% block title %}{{ deal.title }} ‚Äî –ê–∫—Ü–∏—è{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/deal.css' %}">

<article class="deal-card">

  <!-- üîπ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ -->
  <div class="deal-image">
    <img id="deal-image" src="{{ deal.image_url|default:'/static/images/placeholder.jpg' }}" alt="{{ deal.title }}">
    <span class="discount-badge" id="discount-badge">‚àí{{ deal.discount_pct|floatformat:0 }}%</span>
  </div>

  <!-- üîπ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
  <div class="deal-info">
    <h2 class="deal-title" id="deal-title">{{ deal.title }}</h2>

    <!-- –¶–µ–Ω—ã -->
    <div class="price-block">
      <span class="old-price" id="deal-old">{{ deal.price_original }} ‚ÇΩ</span>
      <span class="new-price" id="deal-new">{{ deal.price_discount }} ‚ÇΩ</span>
    </div>

    <!-- –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è -->
    {% if deal.expires_at %}
      {% if deal.expires_at < now %}
        <p class="deal-expire expired"><i class="fa fa-clock-o"></i> –ê–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞</p>
      {% else %}
        <p class="deal-expire"><i class="fa fa-calendar"></i> –î–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ {{ deal.expires_at|date:"d.m.Y" }}</p>
      {% endif %}
    {% endif %}

    <!-- üîπ –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
    <div class="deal-actions">

      <div class="user-actions">
        {% if user.is_authenticated %}
          {% if is_fav %}
            <a class="btn btn-remove" href="{% url 'discounts:toggle_favorite' deal.id %}">
              <i class="fa fa-heart"></i> –£–±—Ä–∞—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
            </a>
          {% else %}
            <a class="btn btn-add" href="{% url 'discounts:toggle_favorite' deal.id %}">
              <i class="fa fa-heart-o"></i> –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
            </a>
          {% endif %}
        {% else %}
          <a class="btn btn-login" href="{% url 'login' %}">
            <i class="fa fa-user"></i> –í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
          </a>
        {% endif %}
      </div>

      {% if user.is_staff %}
      <div class="admin-actions">
        <a href="{% url 'discounts:deal_edit' deal.pk %}" class="btn-admin edit">
          –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </a>
        <a href="{% url 'discounts:deal_delete' deal.pk %}" class="btn-admin delete">
          –£–¥–∞–ª–∏—Ç—å
        </a>
      </div>
      {% endif %}
    </div>

    <!-- üîπ –û–ø–∏—Å–∞–Ω–∏–µ -->
    <div class="deal-description" id="description-text">
      <h3>–û–ø–∏—Å–∞–Ω–∏–µ</h3>
      <p>
        {% if deal.description %}
          {{ deal.description|linebreaks }}
        {% else %}
          <em>–û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ.</em>
        {% endif %}
      </p>
    </div>
  </div>
</article>

<script src="{% static 'js/edit_deal.js' %}"></script>
{% endblock %}