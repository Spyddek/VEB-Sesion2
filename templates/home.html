{% extends "base.html" %}
{% load static %}

{% block title %}Главная — Скидки{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">

{% if user.is_staff %}
  <p>
    <a href="{% url 'discounts:deal_create' %}" class="btn">Создать акцию</a>
  </p>
{% endif %}

<section>
  <h2>Топ-скидки</h2>
  <div class="cards">
    {% for d in top_deals %}
      <div class="card">
        <img src="{{ d.image_url|default:'/static/images/placeholder.jpg' }}" alt="{{ d.title }}">
        <div class="card-body">
          <h3>
            <a href="{% url 'discounts:deal_detail' d.id %}">{{ d.title }}</a>
          </h3>
          <p class="price">
            <span class="old">{{ d.price_original }} ₽</span>
            <span class="new">{{ d.price_discount }} ₽</span>
          </p>
          <a href="{% url 'discounts:deal_detail' d.id %}" class="btn">Подробнее</a>
        </div>
      </div>
    {% empty %}
      <p>Нет активных акций.</p>
    {% endfor %}
  </div>
</section>

<section>
  <h2>Скоро заканчиваются</h2>
  <ol class="deal-list">
    {% for d in ending_soon %}
      <li>
        <a href="{% url 'discounts:deal_detail' d.id %}">{{ d.title }}</a>
        <small class="muted">— до {{ d.expires_at|date:"d.m" }}</small>
      </li>
    {% empty %}
      <li>Нет акций, которые скоро закончатся.</li>
    {% endfor %}
  </ol>
</section>

<section>
  <h2>Популярные категории</h2>
  <div class="cards">
    {% for c in cat_stats %}
      <div class="card">
        <div class="card-body text-center">
          <a href="{% url 'discounts:category' c.id %}" class="text-decoration-none">
            <strong>{{ c.name }}</strong>
          </a>
          <br>
          <small class="muted">Акций: {{ c.active_count|default:0 }}</small>
        </div>
      </div>
    {% empty %}
      <p>Категории отсутствуют.</p>
    {% endfor %}
  </div>
</section>

{% endblock %}