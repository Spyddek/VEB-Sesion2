{% extends "base.html" %}
{% block title %}Главная — Скидки{% endblock %}
{% block content %}

<style>
  /* Сохраняем стили ссылок (они у тебя были в шаблоне) */
  a {
    color: #000;
    text-decoration: none;
  }
  a:visited {
    color: #000;
  }
  a:hover {
    color: #333;
  }
  a:active, a:focus {
    outline: none;
    color: #000;
  }

  a.btn {
    background: #555;
    color: #fff;
    padding: 6px 12px;
    border-radius: 6px;
    display: inline-block;
    margin-bottom: 15px;
  }
  a.btn:hover {
    background: #333;
    color: #fff;
  }
</style>

{% if user.is_staff %}
  <p>
    <a href="{% url 'discounts:deal_create' %}" class="btn">➕ Создать акцию</a>
  </p>
{% endif %}

<section>
  <h2>Топ-скидки</h2>

  <!-- ✅ Используем класс .cards, а не .grid -->
  <div class="cards">
    {% for d in top_deals %}
      <div class="card">
        <img src="{{ d.image_url|default:'/static/images/placeholder.jpg' }}" alt="{{ d.title }}">
        <div class="card-body">
          <h3>
            <a href="{% url 'discounts:deal_detail' d.id %}">
              {{ d.title }}
            </a>
          </h3>
          <p class="price">
            <span class="old">{{ d.price_original }} ₽</span>
            <span class="new">{{ d.price_discount }} ₽</span>
          </p>
          <a href="{% url 'discounts:deal_detail' d.id %}" class="btn">Подробнее</a>
        </div>
      </div>
    {% empty %}
      <p>Нет активных акций.</p>
    {% endfor %}
  </div>
</section>

<section>
  <h2>Скоро заканчиваются</h2>
  <ol class="deal-list">
    {% for d in ending_soon %}
      <li>
        <a href="{% url 'discounts:deal_detail' d.id %}">
          {{ d.title }}
        </a>
        <small class="muted">— до {{ d.expires_at|date:"d.m" }}</small>
      </li>
    {% empty %}
      <li>Нет акций, которые скоро закончатся.</li>
    {% endfor %}
  </ol>
  <p><a href="{% url 'discounts:search' %}?q=">Полный календарь окончаний</a></p>
</section>

<section>
  <h2>Популярные категории</h2>
  <div class="cards">
    {% for c in cat_stats %}
      <div class="card">
        <div class="card-body text-center">
          <a href="{% url 'discounts:category' c.id %}" class="text-decoration-none">
            <strong>{{ c.name }}</strong>
          </a>
          <br>
          <small class="muted">Акций: {{ c.active_count|default:0 }}</small>
        </div>
      </div>
    {% empty %}
      <p>Категории отсутствуют.</p>
    {% endfor %}
  </div>
</section>

{% endblock %}