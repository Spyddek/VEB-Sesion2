{% extends "base.html" %}
{% block title %}Главная — Скидки{% endblock %}
{% block content %}

<style>
  a {
    color: #000;
    text-decoration: none;
  }
  a:visited {
    color: #000;
  }
  a:hover {
    color: #333;
  }
  a:active, a:focus {
    outline: none;
    color: #000;
  }

  a.btn {
    background: #555;
    color: #fff;
    padding: 6px 12px;
    border-radius: 6px;
    display: inline-block;
    margin-bottom: 15px;
  }
  a.btn:hover {
    background: #333;
    color: #fff;
  }
</style>

{% if user.is_staff %}
  <p>
    <a href="{% url 'discounts:deal_create' %}" class="btn">➕ Создать акцию</a>
  </p>
{% endif %}

<section>
  <h2>Топ-скидки</h2>
  <div class="grid">
    {% for d in top_deals %}
    <article class="card">
      <img src="{{ d.image_url|default:'/static/images/placeholder.jpg' }}" alt="">
      <h3><a href="{% url 'discounts:deal_detail' d.id %}">{{ d.title }}</a></h3>
      <p><span class="badge">−{{ d.discount_pct|floatformat:0 }}%</span>
         <span class="price">{{ d.price_discount }} ₽</span>
         <span class="old-price">{{ d.price_original }} ₽</span></p>
    </article>
    {% empty %}<p>Нет активных акций.</p>{% endfor %}
  </div>
</section>

<section>
  <h2>Скоро заканчиваются</h2>
  <ol class="numbered">
    {% for d in ending_soon %}
      <li><a href="{% url 'discounts:deal_detail' d.id %}">{{ d.title }}</a>
          <small class="muted">— до {{ d.expires_at|date:"d.m" }}</small></li>
    {% endfor %}
  </ol>
  <p><a href="{% url 'discounts:search' %}?q=">Полный календарь окончаний</a></p>
</section>

<section>
  <h2>Популярные категории</h2>
  <div class="grid">
    {% for c in cat_stats %}
      <article class="card">
        <a href="{% url 'discounts:category' c.id %}"><strong>{{ c.name }}</strong></a><br>
        <small class="muted">Акций: {{ c.active_count|default:0 }}</small>
      </article>
    {% endfor %}
  </div>
</section>

{% endblock %}
